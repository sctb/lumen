!function(){var requirejs,require,define;!function(n){function r(n,r){return g.call(n,r)}function t(n,r){var t,e,i,a,o,u,s,c,f,l,v,d=r&&r.split("/"),p=m.map,h=p&&p["*"]||{};if(n&&"."===n.charAt(0))if(r){for(n=n.split("/"),o=n.length-1,m.nodeIdCompat&&y.test(n[o])&&(n[o]=n[o].replace(y,"")),n=d.slice(0,d.length-1).concat(n),f=0;f<n.length;f+=1)if(v=n[f],"."===v)n.splice(f,1),f-=1;else if(".."===v){if(1===f&&(".."===n[2]||".."===n[0]))break;f>0&&(n.splice(f-1,2),f-=2)}n=n.join("/")}else 0===n.indexOf("./")&&(n=n.substring(2));if((d||h)&&p){for(t=n.split("/"),f=t.length;f>0;f-=1){if(e=t.slice(0,f).join("/"),d)for(l=d.length;l>0;l-=1)if(i=p[d.slice(0,l).join("/")],i&&(i=i[e])){a=i,u=f;break}if(a)break;!s&&h&&h[e]&&(s=h[e],c=f)}!a&&s&&(a=s,u=c),a&&(t.splice(0,u,a),n=t.join("/"))}return n}function e(r,t){return function(){var e=_.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),f.apply(n,e.concat([r,t]))}}function i(n){return function(r){return t(r,n)}}function a(n){return function(r){d[n]=r}}function o(t){if(r(p,t)){var e=p[t];delete p[t],h[t]=!0,c.apply(n,e)}if(!r(d,t)&&!r(h,t))throw new Error("No "+t);return d[t]}function u(n){var r,t=n?n.indexOf("!"):-1;return t>-1&&(r=n.substring(0,t),n=n.substring(t+1,n.length)),[r,n]}function s(n){return function(){return m&&m.config&&m.config[n]||{}}}var c,f,l,v,d={},p={},m={},h={},g=Object.prototype.hasOwnProperty,_=[].slice,y=/\.js$/;l=function(n,r){var e,a=u(n),s=a[0];return n=a[1],s&&(s=t(s,r),e=o(s)),s?n=e&&e.normalize?e.normalize(n,i(r)):t(n,r):(n=t(n,r),a=u(n),s=a[0],n=a[1],s&&(e=o(s))),{f:s?s+"!"+n:n,n:n,pr:s,p:e}},v={require:function(n){return e(n)},exports:function(n){var r=d[n];return"undefined"!=typeof r?r:d[n]={}},module:function(n){return{id:n,uri:"",exports:d[n],config:s(n)}}},c=function(t,i,u,s){var c,f,m,g,_,y,b=[],j=typeof u;if(s=s||t,"undefined"===j||"function"===j){for(i=!i.length&&u.length?["require","exports","module"]:i,_=0;_<i.length;_+=1)if(g=l(i[_],s),f=g.f,"require"===f)b[_]=v.require(t);else if("exports"===f)b[_]=v.exports(t),y=!0;else if("module"===f)c=b[_]=v.module(t);else if(r(d,f)||r(p,f)||r(h,f))b[_]=o(f);else{if(!g.p)throw new Error(t+" missing "+f);g.p.load(g.n,e(s,!0),a(f),{}),b[_]=d[f]}m=u?u.apply(d[t],b):void 0,t&&(c&&c.exports!==n&&c.exports!==d[t]?d[t]=c.exports:m===n&&y||(d[t]=m))}else t&&(d[t]=u)},requirejs=require=f=function(r,t,e,i,a){if("string"==typeof r)return v[r]?v[r](t):o(l(r,t).f);if(!r.splice){if(m=r,m.deps&&f(m.deps,m.callback),!t)return;t.splice?(r=t,t=e,e=null):r=n}return t=t||function(){},"function"==typeof e&&(e=i,i=a),i?c(n,r,t,e):setTimeout(function(){c(n,r,t,e)},4),f},f.config=function(n){return f(n)},requirejs._defined=d,define=function(n,t,e){if("string"!=typeof n)throw new Error("See almond README: incorrect module build, no module name");t.splice||(e=t,t=[]),r(d,n)||r(p,n)||(p[n]=[n,t,e])},define.amd={jQuery:!0}}(),define("almond",function(){}),define("fs",function(){}),define("process",function(){}),define("path",function(){}),define("runtime",["require"],function(n){var r={};environment=[{}],target="js",nil63=function(n){return void 0===n||null===n},is63=function(n){return!nil63(n)},_35=function(n){return n.length||0},none63=function(n){return 0===_35(n)},some63=function(n){return _35(n)>0},one63=function(n){return 1===_35(n)},two63=function(n){return 2===_35(n)},hd=function(n){return n[0]},type=function(n){return typeof n},string63=function(n){return"string"===type(n)},number63=function(n){return"number"===type(n)},boolean63=function(n){return"boolean"===type(n)},function63=function(n){return"function"===type(n)},atom63=function(n){return nil63(n)||string63(n)||number63(n)||boolean63(n)},nan=NaN,inf=1/0,nan63=function(n){return!(n===n)},inf63=function(n){return n===inf||n===-inf},clip=function(n,r,t){return n.substring(r,t)},cut=function(n,r,t){var e,i=[],a=0;e=nil63(r)||0>r?0:r;var o,u=e,s=_35(n);o=nil63(t)||t>s?s:t;for(var c=o;c>u;)i[a]=n[u],u+=1,a+=1;var f=n,l=void 0;for(l in f){var v,d=f[l];v=numeric63(l)?parseInt(l):l;var p=v;number63(p)||(i[p]=d)}return i},keys=function(n){var r=[],t=n,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;var o=i;number63(o)||(r[o]=a)}return r},edge=function(n){return _35(n)-1},inner=function(n){return clip(n,1,edge(n))},tl=function(n){return cut(n,1)},char=function(n,r){return n.charAt(r)},code=function(n,r){return n.charCodeAt(r)},string_literal63=function(n){return string63(n)&&'"'===char(n,0)},id_literal63=function(n){return string63(n)&&"|"===char(n,0)},add=function(n,r){n.push(r)},drop=function(n){return n.pop()},last=function(n){return n[edge(n)]},almost=function(n){return cut(n,0,edge(n))},reverse=function(n){for(var r=keys(n),t=edge(n);t>=0;)add(r,n[t]),t-=1;return r},reduce=function(n,r){return none63(r)?r:one63(r)?hd(r):n(hd(r),reduce(n,tl(r)))},join=function(){var n=unstash(Array.prototype.slice.call(arguments,0));if(two63(n)){var r=n,t=r[0],e=r[1];if(t&&e){var i=[],a=_35(t),o=t,u=void 0;for(u in o){var s,c=o[u];s=numeric63(u)?parseInt(u):u;var f=s;i[f]=c}var l=e,u=void 0;for(u in l){var v,c=l[u];v=numeric63(u)?parseInt(u):u;var d=v;number63(d)&&(d+=a),i[d]=c}return i}return t||e||[]}return reduce(join,n)},find=function(n,r){var t=r,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;var o=n(a);if(o)return o}},first=function(n,r){for(var t=r,e=_35(t),i=0;e>i;){var a=t[i],o=n(a);if(o)return o;i+=1}},in63=function(n,r){return find(function(r){return n===r},r)},pair=function(n){for(var r=[],t=0;t<_35(n);)add(r,[n[t],n[t+1]]),t+=1,t+=1;return r},sort=function(n,r){var t;return r&&(t=function(n,t){return r(n,t)?-1:1}),n.sort(t)},map=function(n,r){for(var t=[],e=r,i=_35(e),a=0;i>a;){var o=e[a],u=n(o);is63(u)&&add(t,u),a+=1}var s=r,c=void 0;for(c in s){var f,o=s[c];f=numeric63(c)?parseInt(c):c;var l=f;if(!number63(l)){var u=n(o);is63(u)&&(t[l]=u)}}return t},keep=function(n,r){return map(function(r){return n(r)?r:void 0},r)},keys63=function(n){var r=n,t=void 0;for(t in r){var e;r[t];e=numeric63(t)?parseInt(t):t;var i=e;if(!number63(i))return!0}return!1},empty63=function(n){var r=n,t=void 0;for(t in r){var e;r[t];e=numeric63(t)?parseInt(t):t;return!1}return!0},stash=function(n){if(keys63(n)){var r=[],t=n,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;var o=i;number63(o)||(r[o]=a)}r._stash=!0,add(n,r)}return n},unstash=function(n){if(none63(n))return[];var r=last(n);if(!atom63(r)&&r._stash){var t=almost(n),e=r,i=void 0;for(i in e){var a,o=e[i];a=numeric63(i)?parseInt(i):i;var u=a;"_stash"!==u&&(t[u]=o)}return t}return n},search=function(n,r,t){var e=n.indexOf(r,t);return e>=0?e:void 0},split=function(n,r){if(""===n||""===r)return[];for(var t=[],e=_35(r);;){var i=search(n,r);if(nil63(i))break;add(t,clip(n,0,i)),n=clip(n,i+e)}return add(t,n),t},cat=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return none63(n)?"":reduce(function(n,r){return n+r},n)},_43=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return reduce(function(n,r){return n+r},n)},_=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return reduce(function(n,r){return r-n},reverse(n))},_42=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return reduce(function(n,r){return n*r},n)},_47=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return reduce(function(n,r){return r/n},reverse(n))},_37=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return reduce(function(n,r){return r%n},reverse(n))},_62=function(n,r){return n>r},_60=function(n,r){return r>n},_61=function(n,r){return n===r},_6261=function(n,r){return n>=r},_6061=function(n,r){return r>=n},number=function(n){var r=parseFloat(n);return isNaN(r)?void 0:r},number_code63=function(n){return n>47&&58>n},numeric63=function(n){for(var r=_35(n),t=0;r>t;){if(!number_code63(code(n,t)))return!1;t+=1}return!0};var t=function(n){return n.toString()};escape=function(n){for(var r='"',t=0;t<_35(n);){var e,i=char(n,t);if("\n"===i)e="\\n";else{var a;if('"'===i)a='\\"';else{var o;o="\\"===i?"\\\\":i,a=o}e=a}var u=e;r+=u,t+=1}return r+'"'},str=function(n,r){if(r&&r>40)return"circular";if(nil63(n))return"nil";if(nan63(n))return"nan";if(n===inf)return"inf";if(n===-inf)return"-inf";if(boolean63(n))return n?"true":"false";if(string63(n))return escape(n);if(atom63(n))return t(n);if(function63(n))return"function";var e="(",i="",a=[],o=[],u=(r||0)+1,s=n,c=void 0;for(c in s){var f,l=s[c];f=numeric63(c)?parseInt(c):c;var v=f;number63(v)?a[v]=str(l,u):(add(o,v+":"),add(o,str(l,u)))}var d=join(a,o),p=void 0;for(p in d){var m,l=d[p];m=numeric63(p)?parseInt(p):p;e=e+i+l,i=" "}return e+")"},apply=function(n,r){var t=stash(r);return n.apply(n,t)},call=function(n){return n()},toplevel63=function(){return one63(environment)},setenv=function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);if(string63(n)){var i;i=e.toplevel?hd(environment):last(environment);var a=i,o=a[n]||{},u=e,s=void 0;for(s in u){var c,f=u[s];c=numeric63(s)?parseInt(s):s;var l=c;o[l]=f}return a[n]=o,a[n]}},print=function(n){return console.log(n)};var e=Math;return abs=e.abs,acos=e.acos,asin=e.asin,atan=e.atan,atan2=e.atan2,ceil=e.ceil,cos=e.cos,floor=e.floor,log=e.log,log10=e.log10,max=e.max,min=e.min,pow=e.pow,random=e.random,sin=e.sin,sinh=e.sinh,sqrt=e.sqrt,tan=e.tan,tanh=e.tanh,browser63=!("undefined"==typeof window),browser63&&(global=window),r}),define("macros",["require"],function(require){var exports={};return setenv("quote",{_stash:!0,macro:function(n){return quoted(n)}}),setenv("quasiquote",{_stash:!0,macro:function(n){return quasiexpand(n,1)}}),setenv("at",{_stash:!0,macro:function(n,r){return"lua"===target&&number63(r)?r+=1:"lua"===target&&(r=["+",r,1]),["get",n,r]}}),setenv("wipe",{_stash:!0,macro:function(n){return"lua"===target?["set",n,"nil"]:["%delete",n]}}),setenv("list",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0)),r=unique("x"),t=[],e=[],i=n,a=void 0;for(a in i){var o,u=i[a];o=numeric63(a)?parseInt(a):a;var s=o;number63(s)?t[s]=u:add(e,["set",["get",r,["quote",s]],u])}return some63(e)?join(["let",r,join(["%array"],t)],e,[r]):join(["%array"],t)}}),setenv("if",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0));return hd(expand_if(n))}}),setenv("case",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0),i=map(function(r){var t=r,e=t[0],i=t[1];return nil63(i)?[e]:[["=",["quote",e],n],i]},pair(e));return join(["if"],apply(join,i))}}),setenv("when",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);return["if",n,join(["do"],e)]}}),setenv("unless",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);return["if",["not",n],join(["do"],e)]}}),setenv("obj",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0));return join(["%object"],mapo(function(n){return n},n))}}),setenv("let",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);if(atom63(n))return join(["let",[n,hd(e)]],tl(e));if(none63(n))return join(["do"],e);var i=n,a=i[0],o=i[1],u=cut(i,2),s=bind(a,o),c=s[0],f=s[1],l=cut(s,2),v=[];if(bound63(c)||toplevel63()){var d=unique(c);v=[c,d],c=d}else setenv(c,{_stash:!0,variable:!0});return["do",["%local",c,f],["let-symbol",v,join(["let",join(l,u)],e)]]}}),setenv("with",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0);return join(["let",[n,r]],i,[n])}}),setenv("let-when",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0),a=unique("y");return["let",a,r,["when",a,join(["let",[n,a]],i)]]}}),setenv("define-macro",{_stash:!0,macro:function(name,args){var _r25=unstash(Array.prototype.slice.call(arguments,2)),_id19=_r25,body=cut(_id19,0),_x89=["setenv",["quote",name]];_x89.macro=join(["fn",args],body);var form=_x89;return eval(form),form}}),setenv("define-special",{_stash:!0,macro:function(name,args){var _r27=unstash(Array.prototype.slice.call(arguments,2)),_id21=_r27,body=cut(_id21,0),_x96=["setenv",["quote",name]];_x96.special=join(["fn",args],body);var form=join(_x96,keys(body));return eval(form),form}}),setenv("define-symbol",{_stash:!0,macro:function(n,r){setenv(n,{_stash:!0,symbol:r});var t=["setenv",["quote",n]];return t.symbol=["quote",r],t}}),setenv("define-reader",{_stash:!0,macro:function(n){var r=n,t=r[0],e=r[1],i=unstash(Array.prototype.slice.call(arguments,1)),a=i,o=cut(a,0);return["set",["get","read-table",t],join(["fn",[e]],o)]}}),setenv("define",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0);return setenv(n,{_stash:!0,variable:!0}),some63(i)?join(["%local-function",n],bind42(r,i)):["%local",n,r]}}),setenv("define-global",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0);return setenv(n,{_stash:!0,toplevel:!0,variable:!0}),some63(i)?join(["%global-function",n],bind42(r,i)):["set",n,r]}}),setenv("with-frame",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0)),r=unique("x");return["do",["add","environment",["obj"]],["with",r,join(["do"],n),["drop","environment"]]]}}),setenv("with-bindings",{_stash:!0,macro:function(n){var r=n,t=r[0],e=unstash(Array.prototype.slice.call(arguments,1)),i=e,a=cut(i,0),o=unique("x"),u=["setenv",o];return u.variable=!0,join(["with-frame",["each",o,t,u]],a)}}),setenv("let-macro",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);add(environment,{}),map(function(n){return macroexpand(join(["define-macro"],n))},n);var i=join(["do"],macroexpand(e));return drop(environment),i}}),setenv("let-symbol",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);add(environment,{}),map(function(n){var r=n,t=r[0],e=r[1];return macroexpand(["define-symbol",t,e])},pair(n));var i=join(["do"],macroexpand(e));return drop(environment),i}}),setenv("let-unique",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0),i=map(function(n){return[n,["unique",["quote",n]]]},n);return join(["let",apply(join,i)],e)}}),setenv("fn",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);return join(["%function"],bind42(n,e))}}),setenv("guard",{_stash:!0,macro:function(n){if("js"===target)return[["fn",join(),["%try",["list",!0,n]]]];var r=unique("x"),t=unique("msg"),e=unique("trace");return["let",[r,"nil",t,"nil",e,"nil"],["if",["xpcall",["fn",join(),["set",r,n]],["fn",["m"],["set",t,["clip","m",["+",["search","m",'": "'],2]]],["set",e,[["get","debug",["quote","traceback"]]]]]],["list",!0,r],["list",!1,t,e]]]}}),setenv("each",{_stash:!0,macro:function(n,r){var t,e=unstash(Array.prototype.slice.call(arguments,2)),i=e,a=cut(i,0),o=unique("o"),u=(unique("n"),unique("i"));if(atom63(n))t=[u,n];else{var s;s=_35(n)>1?n:[u,hd(n)],t=s}var c,f=t,l=f[0],v=f[1];return c="lua"===target?a:[join(["let",l,["if",["numeric?",l],["parseInt",l],l]],a)],["let",[o,r,l,"nil"],["%for",o,l,join(["let",[v,["get",o,l]]],c)]]}}),setenv("for",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0);return["let",n,0,join(["while",["<",n,r]],i,[["inc",n]])]}}),setenv("step",{_stash:!0,macro:function(n,r){var t=unstash(Array.prototype.slice.call(arguments,2)),e=t,i=cut(e,0),a=unique("x"),o=unique("n"),u=unique("i");return["let",[a,r,o,["#",a]],["for",u,o,join(["let",[n,["at",a,u]]],i)]]}}),setenv("set-of",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0)),r=[],t=n,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;r[a]=!0}return join(["obj"],r)}}),setenv("language",{_stash:!0,macro:function(){return["quote",target]}}),setenv("target",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0));return n[target]}}),setenv("join!",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);return["set",n,join(["join",n],e)]}}),setenv("cat!",{_stash:!0,macro:function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=cut(t,0);return["set",n,join(["cat",n],e)]}}),setenv("inc",{_stash:!0,macro:function(n,r){return["set",n,["+",n,r||1]]}}),setenv("dec",{_stash:!0,macro:function(n,r){return["set",n,["-",n,r||1]]}}),setenv("with-indent",{_stash:!0,macro:function(n){var r=unique("x");return["do",["inc","indent-level"],["with",r,n,["dec","indent-level"]]]}}),setenv("export",{_stash:!0,macro:function(){var n=unstash(Array.prototype.slice.call(arguments,0));if("js"===target)return join(["do"],map(function(n){return["set",["get","exports",["quote",n]],n]},n));var r={},t=n,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;r[a]=a}return["return",join(["obj"],r)]}}),exports}),define("reader",["require"],function(n){var r={},t={"\n":!0,";":!0,"(":!0,")":!0},e={" ":!0,"	":!0,"\n":!0},i=function(n,r){return{more:r,pos:0,len:_35(n),string:n}},a=function(n){var r=n,t=r.pos,e=r.len,i=r.string;return e>t?char(i,t):void 0},o=function(n){var r=a(n);return r?(n.pos=n.pos+1,r):void 0},u=function(n){for(;;){var r=a(n);if(nil63(r))break;if(e[r])o(n);else{if(";"!==r)break;for(;r&&"\n"!==r;)r=o(n);u(n)}}},s={},c={},f=function(n){u(n);var r=a(n);return is63(r)?(s[r]||s[""])(n):c},l=function(n){for(var r=[];;){var t=f(n);if(t===c)break;add(r,t)}return r},v=function(n,r){var t=f(i(n,r));return t!==c?t:void 0},d=function(n){return string63(n)&&_35(n)>1&&":"===char(n,edge(n))},p=function(n){return string63(n)&&_35(n)>1&&":"===char(n,0)},m=function(n,r){var t,e=n,i=e.more,a=e.pos,o=i;if(!o)throw new Error("Expected "+r+" at "+a);return t=o},h=function(n,r){var t=f(n);return t===n.more?t:[r,t]};return s[""]=function(n){for(var r="";;){var i=a(n);if(!i||e[i]||t[i])break;r+=o(n)}if("true"===r)return!0;if("false"===r)return!1;if("nan"===r)return nan;if("-nan"===r)return nan;if("inf"===r)return inf;if("-inf"===r)return-inf;if(number_code63(code(r,edge(r)))){var u=number(r);return nil63(u)||nan63(u)||inf63(u)?r:u}return r},s["("]=function(n){o(n);for(var r=void 0,t=[];nil63(r);){u(n);var e=a(n);if(")"===e)o(n),r=t;else if(nil63(e))r=m(n,")");else{var i=f(n);if(d(i)){var s=clip(i,0,edge(i)),c=f(n);t[s]=c}else p(i)?t[clip(i,1)]=!0:add(t,i)}}return r},s[")"]=function(n){throw new Error("Unexpected ) at "+n.pos)},s['"']=function(n){o(n);for(var r=void 0,t='"';nil63(r);){var e=a(n);'"'===e?r=t+o(n):nil63(e)?r=m(n,'"'):("\\"===e&&(t+=o(n)),t+=o(n))}return r},s["|"]=function(n){o(n);for(var r=void 0,t="|";nil63(r);){var e=a(n);"|"===e?r=t+o(n):nil63(e)?r=m(n,"|"):t+=o(n)}return r},s["'"]=function(n){return o(n),h(n,"quote")},s["`"]=function(n){return o(n),h(n,"quasiquote")},s[","]=function(n){return o(n),"@"===a(n)?(o(n),h(n,"unquote-splicing")):h(n,"unquote")},r.stream=i,r.read=f,r["read-all"]=l,r["read-string"]=v,r["read-table"]=s,r}),define("compiler",["require","reader"],function(n){var r={},t=(n("reader"),function(n,r){if(string63(n))for(var t=edge(environment);t>=0;){var e=environment[t][n];if(is63(e)){var i;return i=r?e[r]:e}t-=1}}),e=function(n){return t(n,"macro")},i=function(n){return is63(e(n))},a=function(n){return is63(t(n,"special"))},o=function(n){return!atom63(n)&&a(hd(n))},u=function(n){return a(n)&&t(n,"stmt")},s=function(n){return t(n,"symbol")},c=function(n){return is63(s(n))},f=function(n){var r=first(function(r){return r[n]},reverse(environment));return!atom63(r)&&is63(r.variable)};bound63=function(n){return i(n)||a(n)||c(n)||f(n)},quoted=function(n){return string63(n)?escape(n):atom63(n)?n:join(["list"],map(quoted,n))};var l=function(n){return string_literal63(n)?n:quoted(n)},v={};unique=function(n){if(v[n]){var r=v[n];return v[n]=v[n]+1,unique(n+r)}return v[n]=1,"_"+n};var d=function(n){if(keys63(n)){var r=["%object",'"_stash"',!0],t=n,e=void 0;for(e in t){var i,a=t[e];i=numeric63(e)?parseInt(e):e;var o=i;number63(o)||(add(r,l(o)),add(r,a))}return join(n,[r])}return n},p=function(n){return number63(n)&&"js"!==target&&("js"===target?n-=1:n+=1),n};bind=function(n,r){if(atom63(n))return[n,r];var t=unique("id"),e=[t,r],i=n,a=void 0;for(a in i){var o,u=i[a];o=numeric63(a)?parseInt(a):a;var s,c=o;s="rest"===c?["cut",t,_35(n)]:["get",t,["quote",p(c)]];var f=s;if(is63(c)){var l;l=u===!0?c:u;var v=l;e=join(e,bind(v,f))}}return e},setenv("arguments%",{_stash:!0,macro:function(n){return[["get",["get",["get","Array",["quote","prototype"]],["quote","slice"]],["quote","call"]],"arguments",n]}}),bind42=function(n,r){var t=[],e=function(){return"js"===target?["unstash",["arguments%",_35(t)]]:(add(t,"|...|"),["unstash",["list","|...|"]])};if(atom63(n))return[t,join(["let",[n,e()]],r)];var i=[],a=unique("r"),o=n,u=void 0;for(u in o){var s,c=o[u];s=numeric63(u)?parseInt(u):u;var f=s;if(number63(f))if(atom63(c))add(t,c);else{var l=unique("x");add(t,l),i=join(i,[c,l])}}return keys63(n)&&(i=join(i,[a,e()]),i=join(i,[keys(n),a])),[t,join(["let",i],r)]};var m=function(n){return number63(n)},h=function(n){return m(n)&&n>0},g=function(n){return m(n)&&1===n},_=function(n,r){return g(r)&&!atom63(n)&&"unquote-splicing"===hd(n)},y=function(n){var r=n,t=(r[0],r[1]),e=r[2];return["%local",t,macroexpand(e)]},b=function(n){var r=n,t=(r[0],r[1]),e=cut(r,2);add(environment,{});var i=t,a=void 0;for(a in i){var o,u=i[a];o=numeric63(a)?parseInt(a):a;setenv(u,{_stash:!0,variable:!0})}var s=join(["%function",t],macroexpand(e));return drop(environment),s},j=function(n){var r=n,t=r[0],e=r[1],i=r[2],a=cut(r,3);add(environment,{});var o=i,u=void 0;for(u in o){var s,c=o[u];s=numeric63(u)?parseInt(u):u;setenv(c,{_stash:!0,variable:!0})}var f=join([t,e,i],macroexpand(a));return drop(environment),f},q=function(n){var r=n,t=r[0],i=cut(r,1);return macroexpand(apply(e(t),i))};macroexpand=function(n){if(c(n))return macroexpand(s(n));if(atom63(n))return n;var r=hd(n);return"%local"===r?y(n):"%function"===r?b(n):"%global-function"===r?j(n):"%local-function"===r?j(n):i(r)?q(n):map(macroexpand,n)};var w=function(n,r){var t=[["list"]],e=n,i=void 0;for(i in e){var a,o=e[i];a=numeric63(i)?parseInt(i):i;var u=a;if(!number63(u)){var s;s=_(o,r)?quasiexpand(o[1]):quasiexpand(o,r);var c=s;last(t)[u]=c}}for(var f=n,l=_35(f),v=0;l>v;){var d=f[v];if(_(d,r)){var p=quasiexpand(d[1]);add(t,p),add(t,["list"])}else add(last(t),quasiexpand(d,r));v+=1}var m=keep(function(n){return _35(n)>1||!("list"===hd(n))||keys63(n)},t);return one63(m)?hd(m):join(["join"],m)};quasiexpand=function(n,r){return h(r)?atom63(n)?["quote",n]:g(r)&&"unquote"===hd(n)?quasiexpand(n[1]):"unquote"===hd(n)||"unquote-splicing"===hd(n)?w(n,r-1):"quasiquote"===hd(n)?w(n,r+1):w(n,r):atom63(n)?n:"quote"===hd(n)?n:"quasiquote"===hd(n)?quasiexpand(n[1],1):map(function(n){return quasiexpand(n,r)},n)},expand_if=function(n){var r=n,t=r[0],e=r[1],i=cut(r,2);return is63(e)?[join(["%if",t,e],expand_if(i))]:is63(t)?[t]:void 0},indent_level=0,indentation=function(){for(var n="",r=0;r<indent_level;)n+="  ",r+=1;return n};var x={"var":!0,until:!0,"continue":!0,"-":!0,"in":!0,"for":!0,"default":!0,"<=":!0,">=":!0,"while":!0,repeat:!0,"do":!0,or:!0,local:!0,"*":!0,"void":!0,"<":!0,"true":!0,"break":!0,"false":!0,"this":!0,"new":!0,elseif:!0,nil:!0,then:!0,"switch":!0,"finally":!0,"debugger":!0,"with":!0,end:!0,"function":!0,"==":!0,"case":!0,and:!0,"typeof":!0,"try":!0,"return":!0,"=":!0,"if":!0,"instanceof":!0,"catch":!0,"delete":!0,"+":!0,"else":!0,"/":!0,">":!0,"throw":!0,"%":!0,not:!0};reserved63=function(n){return x[n]};var A=function(n){return number_code63(n)||n>64&&91>n||n>96&&123>n||95===n};valid_id63=function(n){if(none63(n)||reserved63(n))return!1;for(var r=0;r<_35(n);){if(!A(code(n,r)))return!1;r+=1}return!0},key=function(n){var r=inner(n);return valid_id63(r)?r:"js"===target?n:"["+n+"]"},mapo=function(n,r){var t=[],e=r,i=void 0;for(i in e){var a,o=e[i];a=numeric63(i)?parseInt(i):i;var u=a,s=n(o);is63(s)&&(add(t,l(u)),add(t,s))}return t};var k=[],I=[];I.lua="not",I.js="!",k.not=I;var E=[];E["/"]=!0,E["*"]=!0,E["%"]=!0;var O=[];O["+"]=!0,O["-"]=!0;var N=[],S=[];S.lua="..",S.js="+",N.cat=S;var C=[];C["<="]=!0,C[">"]=!0,C[">="]=!0,C["<"]=!0;var F=[],z=[];z.lua="==",z.js="===",F["="]=z;var M=[],T=[];T.lua="and",T.js="&&",M.and=T;var D=[],P=[];P.lua="or",P.js="||",D.or=P;var Q=[k,E,O,N,C,F,M,D],R=function(n){return two63(n)&&in63(hd(n),["not","-"])},U=function(n){return n},$=function(n){if(!atom63(n)&&!R(n)){var r=Q,t=void 0;for(t in r){var e,i=r[t];e=numeric63(t)?parseInt(t):t;var a=e;if(i[hd(n)])return U(a)}}return 0},B=function(n){return find(function(r){var t=r[n];return t===!0?n:is63(t)?t[target]:void 0},Q)},G=function(n){return is63(B(n))},H=function(n){for(var r="(",t="",e=n,i=_35(e),a=0;i>a;){var o=e[a];r=r+t+compile(o),t=", ",a+=1}return r+")"},J=function(n){for(var r="",t=0;t<_35(n);){var e,i=char(n,t);e="\n"===i?"\\n":i,r+=e,t+=1}return r},K=function(n){for(var r="",t=0;t<_35(n);){var e,i=char(n,t),a=code(i);if("-"===i)e="_";else{var o;if(A(a))o=i;else{var u;u=0===t?"_"+a:a,o=u}e=o}var s=e;r+=s,t+=1}return reserved63(r)?"_"+r:r},L=function(n){if("nil"===n&&"lua"===target)return n;if("nil"===n)return"undefined";if(id_literal63(n))return inner(n);if(string_literal63(n))return J(n);if(string63(n))return K(n);if(boolean63(n))return n?"true":"false";if(nan63(n))return"nan";if(n===inf)return"inf";if(n===-inf)return"-inf";if(number63(n))return n+"";throw new Error("Cannot compile atom: "+str(n))},V=function(n){return n?"js"===target?";\n":"\n":""},W=function(n,r){var e=n,i=e[0],a=cut(e,1),o=t(i),u=o.special,s=(o.stmt,o.tr),c=V(r&&!s);return apply(u,a)+c},X=function(n){return!atom63(n)&&"%function"===hd(n)||$(n)>0},Y=function(n){var r=hd(n),t=compile(r),e=H(d(tl(n)));return X(r)?"("+t+")"+e:t+e},Z=function(n,r){var t,e=unstash(Array.prototype.slice.call(arguments,2)),i=e,a=i.right;return t=a?_6261:_62,t($(r),$(n))?["(",")"]:["",""]},nn=function(n){var r=n,t=r[0],e=cut(r,1),i=e[0],a=e[1],o=Z(n,i),u=o[0],s=o[1],c=Z(n,a,{_stash:!0,right:!0}),f=c[0],l=c[1],v=compile(i),d=compile(a),p=B(t);return R(n)?p+u+" "+v+s:u+v+s+" "+p+" "+f+d+l};compile_function=function(n,r){var t,e=unstash(Array.prototype.slice.call(arguments,2)),i=e,a=i.prefix,o=i.name;t=o?compile(o):"";var u=t,s=H(n);indent_level+=1;var c=compile(r,{_stash:!0,stmt:!0});indent_level-=1;var f,l=c,v=indentation();f=a?a+" ":"";var d,p=f;d="js"===target?"":"end";var m=d;return o&&(m+="\n"),"js"===target?"function "+u+s+" {\n"+l+v+"}"+m:p+"function "+u+s+"\n"+l+v+m};var rn=function(n){return is63(n)&&(atom63(n)||!("return"===hd(n))&&!u(hd(n)))};compile=function(n){var r=unstash(Array.prototype.slice.call(arguments,1)),t=r,e=t.stmt;if(nil63(n))return"";if(o(n))return W(n,e);var i,a=V(e);i=e?indentation():"";var u,s=i;if(atom63(n))u=L(n);else{var c;c=G(hd(n))?nn(n):Y(n),u=c}var f=u;return s+f+a};var tn=function(n,r){var t=[],e=lower(n,t,!0,r);return some63(t)&&is63(e)?join(["do"],t,[e]):is63(e)?e:_35(t)>1?join(["do"],t):hd(t)},en=function(n,r){return tn(join(["do"],n),r)},an=function(n){return atom63(n)||"%array"===hd(n)||"%object"===hd(n)},on=function(n){return!(atom63(n)||G(hd(n))||an(n)||"get"===hd(n))},un=function(n,r,t,e){for(var i=almost(n),a=_35(i),o=0;a>o;){var u=i[o],s=lower(u,r,t);if(s){var c=s;on(c)&&add(r,c)}o+=1}var c=lower(last(n),r,t,e);return e&&rn(c)?["return",c]:c},sn=function(n,r,t,e){var i=n,a=i[0],o=i[1];return add(r,["set",a,lower(o,r)]),!t||e?a:void 0},cn=function(n,r,t,e){var i=n,a=i[0],o=i[1],u=i[2];if(t||e){var s;return u&&(s=[en([u],e)]),add(r,join(["%if",lower(a,r),en([o],e)],s))}var c=unique("e");add(r,["%local",c]);var f;return u&&(f=[lower(["set",c,u])]),add(r,join(["%if",lower(a,r),lower(["set",c,o])],f)),c},fn=function(n,r,t){var e=r,i=e[0],a=e[1],o=[],u=lower(a,o);if(some63(o)){var s,c=unique("id");return s="and"===n?["%if",c,a,c]:["%if",c,c,a],lower(["do",["%local",c,i],s],t)}return[n,lower(i,t),u]},ln=function(n,r,t){return add(r,["%try",en(n,t)])},vn=function(n,r){var t=n,e=t[0],i=cut(t,1);return add(r,["while",lower(e,r),en(i)])},dn=function(n,r){var t=n,e=t[0],i=t[1],a=cut(t,2);return add(r,["%for",lower(e,r),i,en(a)])},pn=function(n){var r=n,t=r[0],e=cut(r,1);return["%function",t,en(e,!0)]},mn=function(n,r,t){var e=r,i=e[0],a=e[1],o=cut(e,2);return add(t,[n,i,a,en(o,!0)])},hn=function(n,r){var t=map(function(n){return lower(n,r)},n);return some63(t)?t:void 0},gn=function(n){return G(hd(n))&&_35(n)>3},_n=function(n,r){var t=n,e=t[0],i=cut(t,1);return lower(reduce(function(n,r){return[e,r,n]},reverse(i)),r)},yn=function(n,r){var t=hn(n,r);return t?add(r,t):void 0};lower=function(n,r,t,e){if(atom63(n))return n;if(empty63(n))return["%array"];if(nil63(r))return tn(n);if(gn(n))return _n(n,r);var i=n,a=i[0],o=cut(i,1);return"do"===a?un(o,r,t,e):"set"===a?sn(o,r,t,e):"%if"===a?cn(o,r,t,e):"%try"===a?ln(o,r,e):"while"===a?vn(o,r):"%for"===a?dn(o,r):"%function"===a?pn(o):"%local-function"===a||"%global-function"===a?mn(a,o,r):in63(a,["and","or"])?fn(a,o,r):u(a)?yn(n,r):hn(n,r)};var bn=function(n){return lower(macroexpand(n))};global.require=n;var jn=eval;return _37result=void 0,eval=function(n){var r=target;target="js";var t=compile(bn(["set","%result",n]));return target=r,jn(t),_37result},setenv("do",{_stash:!0,special:function(){for(var n=unstash(Array.prototype.slice.call(arguments,0)),r="",t=n,e=_35(t),i=0;e>i;){var a=t[i];r+=compile(a,{_stash:!0,stmt:!0}),i+=1}return r},stmt:!0,tr:!0}),setenv("%if",{_stash:!0,special:function(n,r,t){var e=compile(n);indent_level+=1;var i=compile(r,{_stash:!0,stmt:!0});indent_level-=1;var a,o=i;if(t){indent_level+=1;var u=compile(t,{_stash:!0,stmt:!0});indent_level-=1,a=u}var s=a,c=indentation(),f="";return f="js"===target?f+c+"if ("+e+") {\n"+o+c+"}":f+c+"if "+e+" then\n"+o,s&&"js"===target?f=f+" else {\n"+s+c+"}":s&&(f=f+c+"else\n"+s),"lua"===target?f+c+"end\n":f+"\n"},stmt:!0,tr:!0}),setenv("while",{_stash:!0,special:function(n,r){var t=compile(n);indent_level+=1;var e=compile(r,{_stash:!0,stmt:!0});indent_level-=1;var i=e,a=indentation();return"js"===target?a+"while ("+t+") {\n"+i+a+"}\n":a+"while "+t+" do\n"+i+a+"end\n"},stmt:!0,tr:!0}),setenv("%for",{_stash:!0,special:function(n,r,t){var e=compile(n),i=indentation();indent_level+=1;var a=compile(t,{_stash:!0,stmt:!0});indent_level-=1;var o=a;return"lua"===target?i+"for "+r+" in next, "+e+" do\n"+o+i+"end\n":i+"for ("+r+" in "+e+") {\n"+o+i+"}\n"},stmt:!0,tr:!0}),setenv("%try",{_stash:!0,special:function(n){var r=unique("e"),t=indentation();indent_level+=1;var e=compile(n,{_stash:!0,stmt:!0});indent_level-=1;var i=e,a=["return",["%array",!1,["get",r,'"message"'],["get",r,'"stack"']]];indent_level+=1;var o=compile(a,{_stash:!0,stmt:!0});indent_level-=1;var u=o;return t+"try {\n"+i+t+"}\n"+t+"catch ("+r+") {\n"+u+t+"}\n"},stmt:!0,tr:!0}),setenv("%delete",{_stash:!0,stmt:!0,special:function(n){return indentation()+"delete "+compile(n)}}),setenv("break",{_stash:!0,stmt:!0,special:function(){return indentation()+"break"}}),setenv("%function",{_stash:!0,special:function(n,r){return compile_function(n,r)}}),setenv("%global-function",{_stash:!0,special:function(n,r,t){if("lua"===target){var e=compile_function(r,t,{_stash:!0,name:n});return indentation()+e}return compile(["set",n,["%function",r,t]],{_stash:!0,stmt:!0})},stmt:!0,tr:!0}),setenv("%local-function",{_stash:!0,special:function(n,r,t){if("lua"===target){var e=compile_function(r,t,{_stash:!0,prefix:"local",name:n});return indentation()+e}return compile(["%local",n,["%function",r,t]],{_stash:!0,stmt:!0})},stmt:!0,tr:!0}),setenv("return",{_stash:!0,stmt:!0,special:function(n){var r;r=nil63(n)?"return":"return("+compile(n)+")";var t=r;return indentation()+t}}),setenv("new",{_stash:!0,special:function(n){return"new "+compile(n)}}),setenv("typeof",{_stash:!0,special:function(n){return"typeof("+compile(n)+")"}}),setenv("error",{_stash:!0,stmt:!0,special:function(n){var r;r="js"===target?"throw "+compile(["new",["Error",n]]):"error("+compile(n)+")";
var t=r;return indentation()+t}}),setenv("%local",{_stash:!0,stmt:!0,special:function(n,r){var t,e=compile(n),i=compile(r);t=is63(r)?" = "+i:"";var a,o=t;a="js"===target?"var ":"local ";var u=a,s=indentation();return s+u+e+o}}),setenv("set",{_stash:!0,stmt:!0,special:function(n,r){var t,e=compile(n);t=nil63(r)?"nil":r;var i=compile(t);return indentation()+e+" = "+i}}),setenv("get",{_stash:!0,special:function(n,r){var t=compile(n),e=compile(r);return"lua"===target&&"{"===char(t,0)&&(t="("+t+")"),string_literal63(r)&&valid_id63(inner(r))?t+"."+inner(r):t+"["+e+"]"}}),setenv("%array",{_stash:!0,special:function(){var n,r=unstash(Array.prototype.slice.call(arguments,0));n="lua"===target?"{":"[";var t,e=n;t="lua"===target?"}":"]";var i=t,a="",o="",u=r,s=void 0;for(s in u){var c,f=u[s];c=numeric63(s)?parseInt(s):s;var l=c;number63(l)&&(a=a+o+compile(f),o=", ")}return e+a+i}}),setenv("%object",{_stash:!0,special:function(){var n,r=unstash(Array.prototype.slice.call(arguments,0)),t="{",e="";n="lua"===target?" = ":": ";var i=n,a=pair(r),o=void 0;for(o in a){var u,s=a[o];u=numeric63(o)?parseInt(o):o;var c=u;if(number63(c)){var f=s,l=f[0],v=f[1];if(!string63(l))throw new Error("Illegal key: "+str(l));t=t+e+key(l)+i+compile(v),e=", "}}return t+"}"}}),r.run=jn,r.eval=eval,r.expand=bn,r.compile=compile,r}),define("system",["require","fs","path"],function(n){var r={},t=n("fs");browser63&&(process={argv:[]});var e,i=function(n){return t.readFileSync(n,"utf8")},a=function(n,r){return t.writeFileSync(n,r,"utf8")},o=function(n){return t.existsSync(n,"utf8")};e=browser63?"/":n("path").sep;var u=e,s=function(){var n=unstash(Array.prototype.slice.call(arguments,0));return none63(n)?"":reduce(function(n,r){return n+u+r},n)},c=function(n){return process.env[n]},f=function(n){var r=process.stdout;return r.write(n)},l=function(n){return process.exit(n)},v=cut(process.argv,2);return r["read-file"]=i,r["write-file"]=a,r["file-exists?"]=o,r["path-separator"]=u,r["path-join"]=s,r["get-environment-variable"]=c,r.write=f,r.exit=l,r.argv=v,r}),define("main",["require","reader","compiler","system"],function(n){var r={},t=n("reader"),e=n("compiler"),i=n("system"),a=function(n){var r=function(){try{return[!0,e.eval(n)]}catch(r){return[!1,r.message,r.stack]}}(),t=r[0],i=r[1],a=r[2];return t?is63(i)?print(str(i)):void 0:print(a)},o=function(n){return a(t["read-string"](n))},u=function(){var n="",r=function(r){n+=r;var e=[],o=t["read-string"](n,e);return o!==e?(a(o),n="",i.write("> ")):void 0};i.write("> ");var e=process.stdin;return e.setEncoding("utf8"),e.on("data",r)};compile_file=function(n){var r=t.stream(i["read-file"](n)),a=t["read-all"](r),o=e.expand(join(["do"],a));return e.compile(o,{_stash:!0,stmt:!0})},load=function(n){return e.run(compile_file(n))};var s=function(n){return e.run(i["read-file"](n))},c=function(){return print("usage: lumen [options] <object files>"),print("options:"),print("  -c <input>	Compile input file"),print("  -o <output>	Output file"),print("  -t <target>	Target language (default: lua)"),print("  -e <expr>	Expression to evaluate"),i.exit()},f=function(){var n=hd(i.argv);("-h"===n||"--help"===n)&&c();for(var r=[],t=void 0,e=void 0,a=void 0,f=void 0,l=i.argv,v=_35(l),d=0;v>d;){var p=l[d];if("-c"===p||"-o"===p||"-t"===p||"-e"===p)if(d===v-1)print("missing argument for "+p);else{d+=1;var m=l[d];"-c"===p?t=m:"-o"===p?e=m:"-t"===p?a=m:"-e"===p&&(f=m)}else"-"!==char(p,0)&&add(r,p);d+=1}for(var h=r,g=_35(h),_=0;g>_;){var y=h[_];s(y),_+=1}if(nil63(t))return f?o(f):u();a&&(target=a);var b=compile_file(t);return nil63(e)||"-"===e?print(b):i["write-file"](e,b)};return browser63||f(),r}),require(["runtime","macros","main"])}();
//# sourceMappingURL=lumen-min.js.map